<!DOCTYPE html>
<html lang="en">

<head>

  <!-- 
    Handlebars template for the site 
    - Data for famous people and their quotes/creations.
    - Displays a word cloud with clickable links to Wikipedia and their works.
  -->

  <meta charset="utf-8" />
  <link rel="icon" href="https://glitch.com/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{{seo.title}}</title>

  <!-- Meta tags for SEO and social sharing -->
  <link rel="canonical" href="{{seo.url}}">
  <meta name="description" content="{{seo.description}}">
  <meta property="og:title" content="{{seo.title}}">
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{seo.url}}">
  <meta property="og:description" content="{{seo.description}}">
  <meta property="og:image" content="{{seo.image}}">
  <meta name="twitter:card" content="summary">

  <!-- Import the webpage's stylesheet -->
  <link rel="stylesheet" href="/style.css" />

  <!-- D3 for Word Cloud -->
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.js"></script>

  <style>
    #word-cloud-container {
      width: 100%;
      height: 500px;
      margin-top: 20px;
    }

    .person-link {
      font-size: 20px;
      cursor: pointer;
    }
  </style>

  <script type="text/javascript">
    function createWordCloud(words) {
      const width = document.getElementById('word-cloud-container').offsetWidth;
      const height = 500;

      const layout = d3.layout.cloud()
        .size([width, height])
        .words(words.map(d => ({
          text: d.name,
          size: Math.random() * 40 + 20, // random sizes for visual variety
          link: d.wiki_link, // Use wiki_link for the URL
        })))
        .padding(5)
        .rotate(() => ~~(Math.random() * 2) * 90)
        .fontSize(d => d.size)
        .on("end", draw);

      layout.start();

      function draw(words) {
        d3.select("#word-cloud-container").append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", "translate(" + [width / 2, height / 2] + ")")
          .selectAll("text")
          .data(words)
          .enter().append("text")
          .style("font-size", d => d.size + "px")
          .style("fill", "#69b3a2")
          .attr("text-anchor", "middle")
          .attr("transform", d => `translate(${d.x}, ${d.y}) rotate(${d.rotate})`)
          .text(d => d.text)
          .on("click", function (event, d) {
            window.open(d.link); // Open Wikipedia link on click
          })
          .on("mouseover", function () {
            d3.select(this).style("fill", "#ff6666");
          })
          .on("mouseout", function () {
            d3.select(this).style("fill", "#69b3a2");
          });
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const peopleData = {{optionNames}}; // Data passed from the server as JSON
      createWordCloud(peopleData);
    });
  </script>

</head>

<body>
  <div class="wrapper">
    <div class="content" role="main">
      <h1>Famous People Word Cloud</h1>
      <p>
        Explore famous people and their creations. Click on a name to go to their Wikipedia page.
      </p>

      <div id="word-cloud-container"></div>

      {{#if error}}
      <p class="error">
        {{error}}
      </p>
      {{else}}
      <h2>People Data</h2>

      {{#if optionNames}}
      <ul>
        {{#each optionNames}}
        <li>
          <a href="{{wiki_link}}" target="_blank">{{name}}</a> - {{bio}}
        </li>
        {{/each}}
      </ul>
      {{else}}
      <p>No data available. Please try again later.</p>
      {{/if}}
      {{/if}}

    </div>
  </div>
  <!-- The footer -->
  <footer class="footer">
    <div class="links"></div>
    <a href="/">Home</a>
    <span class="divider">|</span>
    <a href="/logs">Admin</a>
  </footer>
</body>

</html>
